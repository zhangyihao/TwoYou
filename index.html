<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>TravelImg</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="js/jquery.masonry.min.js"></script>
	<link type="text/css" rel="stylesheet" href="css/basic.css"  >
</head>
<body>
	<div id="top">
		<div id="leftHeader">
			<h1><em></em></h1>
			<input type="text" name="search" id="searchInput" />
		</div>
		<div id="logo">
		</div>
		<div id="rightHeader">
			<div id="add"><a href="" title="添加"><em></em></a></div>
			<div id="message"><a href="" title="通知"><em></em></a></div>
			<div id="photo">
				<a href="" title="头像"><img src="images/tx.jpg"/></a>
				<div class="mytravel" style="display:none;">
					<ul>
						<li><a href="" class="self">我的图游</a></li>
						<li><a href="" class="album">我的相册</a></li>
						<li><a href="" class="attention">我的关注</a></li>
						<li><a href="" class="share">我的分享</a></li>
						<li><a href="" class="collect">我的收藏</a></li>
						<li><a href="" class="about">与我相关</a></li>
						<li><a href="" class="comment">我的评论</a></li>
						<li><a href="" class="setting">帐号设置</a></li>
						<li><a href="" class="logout">退出登录</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
	<div id="main">
		<div id="masonry" class="container-fluid">
			<div class="box">
				<div class="img">
					<a href="#"><img src="images/2.jpg"></a>
					<div class="btns" style="display:none;">
						<a href="#" class="fav">喜欢</a>
						<a href="#" class="col">收藏</a>
					</div>
				</div>
				<div class="title">
					<div class="desc"><a href="#">这是一只可爱的猫</a></div>
					<div class="favnum">喜欢(122)</div>
				</div>
				<div class="comment">
					<dl>
						<dt><a href="#"><img src="images/tx1.jpg"/></a></dt>
						<dd class="author"><a href="#">张益达</a></dd>
						<dd><a href="#">在北京的日子</a></dd>
					</dl>
				</div>
			</div>
		</div>
	</div>

</body>
<script type="text/javascript">

var totalPic = 1; //记录加载的图片的总数
var flag = true;  //标记下拉时是否继续加载图片

function TouXiang() {
	/*******我的头像事件 start******/
	var $photo = $('#photo');
	$photo.mouseenter(function () {
		 var y = $photo.position().top+46;//获取当前鼠标滑过的内容的顶部坐标
		 var x = $photo.position().left-134;
		 $('.mytravel').css('top', y);
		 $('.mytravel').css('left', x);
		 $('.mytravel').css('z-index','999');
		 $('.mytravel').show();

	});
	$photo.mouseleave(function () {
		 $('.mytravel').hide();

	});
	/*******我的头像事件 end******/
}

function WaterFall(){
	var $container = $('#masonry');
	$container.imagesLoaded( function(){
		$container.masonry({
			itemSelector : '.box', //class选择器，默认.item
			gutterWidth : 10, //列的间隙
			isAnimated: true, //使用Jquery的布局变化，默认为true
		});
	});

	//滚动条滚动到离底部距离50的时候触发
	$(window).scroll(function(){
		// 当滚动到最底部以上100像素时， 加载新内容
		if ($(document).height() - $(this).scrollTop() - $(this).height()<50){
			if (flag){
				//调用getList()方法获取要加载的图片信息
				var $boxes = $(getList());
				$container.append($boxes).masonry('appended',$boxes);
			}
		}
		item_callback();
	});
}

/*
function WaterFallCallBack() {
	item_callback();
	$('.item').fadeIn();
}

function item_callback() {
	item_masonry();
}
*/
function getList() {
	var boxes = [],count = parseInt(Math.random()*40+1);
	for (var i=2; i <=count; i++ ) {
		if(i!=17 && i!=9 && i!=14 && i!=5 && i!=11 && i!=15) {
			totalPic++;
			boxes.push('<div class="box"><img src="images/'+i+'.jpg"><span class="text">文字'+i+'</span></div>');
			if(totalPic>=210){
				flag=false;
			}
		}
	}
	//把数组转成字符串
	return boxes.join("");
};

function init() {
	var $container = $('#masonry');
	var $div;
	var fav;
	for(var i=3; i<=41; i++) {
		if(i!=17 && i!=9 && i!=14 && i!=15 && i!=5 && i!=11) {
			totalPic++;
			$img = $('<div class="img"><a href="#"><img src="images//'+i+'.jpg"></a><div class="btns" style="display:none;">'
						+'<a href="#" class="col">收藏</a>'
						+'<a href="#" class="fav">喜欢</a>'
					+'</div></div>');
			if(i%4!=0) {
				fav = '<div class="favnum">喜欢(122)</div>'
			} else {
				fav = '';
			}
			$title = $('<div class="title"><div class="desc"><a href="#">这是一只可爱的猫</a></div>'+fav+'</div>');
			$comment = $('<div class="comment"><dl><dt><a href="#"><img src="images/tx1.jpg"/></a></dt><dd class="author"><a href="#">张益达</a></dd>'
					+'<dd><a href="#">在北京的日子</a></dd></dl></div>');
			$div = $('<div class="box"></div>');
			$div.append($img).append($title).append($comment);
			$container.append($div);
		}
	}
}

function FavShow() {
	var $btns = $(this).children().eq(0).children('div').eq(0);
	$btns.css('top', 0);
	$btns.css('left', 0);
	$btns.css('z-index','888');
	$btns.show();
}
function FavHide() {
	$(this).children().eq(0).children('div').eq(0).hide();
}


$(document).ready(function () {
	TouXiang();
	init();
	WaterFall();


	var boxEvent = function () {
		var $box = $('#masonry').children();
		$box.each(function () {
			$(this).mouseenter(FavShow);
			$(this).mouseleave(FavHide);
		});
	}
	boxEvent();
});
</script>

</html>